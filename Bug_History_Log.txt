# DocRefine Pro - Major Bug & Regression History
# The Architect Gem should consult this list before suggesting architectural changes.

## 1. Threading & Performance
* **The GIL Bottleneck (v102 Regression):**
    * *Issue:* Moving "Ingest" (pure Python string operations) to ThreadPoolExecutor *slowed down* processing due to Python's Global Interpreter Lock (GIL) context switching.
    * *Rule:* CPU-bound Python tasks (like string hashing) must remain Single-Threaded or use `multiprocessing` (carefully). Only I/O bound tasks or external binaries (Poppler/Tesseract) should use `ThreadPoolExecutor`.

* **UI Freeze on Export (v108 Regression):**
    * *Issue:* Running file copy/zip operations on the Main Thread caused the window to hang ("Not Responding") during export.
    * *Rule:* All file I/O operations > 100ms must be wrapped in a separate thread.

## 2. Window Management (Tkinter)
* **The "Jump to Monitor 1" Bug (v102):**
    * *Issue:* Calculating window geometry before `.update_idletasks()` caused windows to spawn at (0,0) on the primary monitor instead of centered on the parent.
    * *Rule:* Always `withdraw()` -> `update_idletasks()` -> Calculate Geometry -> `deiconify()`.

* **Negative Coordinates (v103 Regression):**
    * *Issue:* Using `max(0, x)` to sanitize coordinates broke multi-monitor setups where the left monitor has negative X values.
    * *Rule:* Never clamp window coordinates to 0. Trust `winfo_rootx()`.

* **Mac Dock Occlusion:**
    * *Issue:* Setting height to `winfo_screenheight()` hides the bottom status bar behind the macOS Dock.
    * *Rule:* On macOS, always subtract ~120px from available screen height.

## 3. Cross-Platform Quirks (Windows vs Mac)
* **File Locking (Windows):**
    * *Issue:* `shutil.make_archive` fails on Windows if the app tries to zip its own active log file (`PermissionError`).
    * *Rule:* Always copy active logs to a temp directory before zipping. Use binary read/write if necessary.

* **Invisible Buttons (Mac Aqua Theme):**
    * *Issue:* Setting `bg="green"` on a standard Tkinter button on Mac results in white text on a white button (invisible).
    * *Rule:* Do not use custom background colors for buttons on macOS. Use standard system buttons.

* **Scroll Sensitivity (Mac Magic Mouse):**
    * *Issue:* Mac trackpads generate continuous high-frequency scroll events, causing "Next Page" logic to skip 10 pages at once.
    * *Rule:* Implement a "Cooldown/Debounce" timer (e.g., 0.4s) on all mouse wheel bindings.

## 4. State Management
* **The "Zombie Worker" (v110):**
    * *Issue:* Stopping a job set a `stop_sig` flag that wasn't cleared, causing the *next* job to abort immediately.
    * *Rule:* Always reset state flags (`stop_sig = False`, `paused = False`) at the very top of any `run_` function.

* **Race Conditions:**
    * *Issue:* UI buttons enabled/disabled based on static variable state, allowing users to click "Run" while a job was already running.
    * *Rule:* Enforce `if self.running: return` checks in all button command logic.